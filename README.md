# Пайплайн для автоматизированной валидации результатов генерации аптамеров

## Описание работы пайплайна

Весь рабочий процесс разделен на 6 последовательных блоков:

### 1. Блок 1: ML-скрининг и консенсус
Предполагается, что в дальнейшем на этот шаг будет подаваться результат генерации. Логика работы будет пересматриваться. Скорее всего, модели в этом шаге будут предобучены на имеющихся данных, а для результатов генерации будут лишь давать оценку.
В данный момент вследствие логики, заложенной в этот шаг, часть данных из датасета отсекается, т.к. входит в тренировочную выборку. Дальше проходят только тестовые строки, которые прошли оценку модели.

На этом этапе происходит первичная обработка входного датасета (`Aptamers_and_targets.csv`).
*   **Действия:**
    *   Предобработка данных и разбиение на выборки.
    *   Запуск нескольких нейросетевых моделей (**Apipred**, **AptaTrans**, **AptaNet**) для предсказания вероятности связывания.
    *   Формирование консенсусного решения (Consensus) на основе результатов моделей.
    *   Отбор лучших кандидатов для дальнейшего структурного моделирования.
*   **Результат:** Файл `candidates_for_docking.csv` и подготовленная структура папок для кандидатов.

### 2. Блок 2: Обработка последовательностей
Промежуточный этап для работы с уникальными последовательностями аптамеров.
*   **Действия:** Свертывание и проверка последовательностей (скрипт `retract_and_fold.py`).

### 3. Блок 3: Предсказание 2D структуры (2D Prediction)
Предсказание вторичной структуры РНК-аптамера.
*   **Инструмент:** RNAfold (или аналогичные алгоритмы в скрипте `2D_aptamer_prediction.py`).
*   **Результат:** Файлы `aptamer.ss` (dot-bracket нотация) для каждого кандидата.

### 4. Блок 4: 3D моделирование аптамера (3D Modeling)
Генерация третичной структуры аптамера на основе его вторичной структуры.
*   **Шаг 4.1 (NSP Assembly):** Генерация пула черновых 3D-моделей с использованием инструмента **NSP** (NSP/cirRNA_and_DNA/nsp).
*   **Шаг 4.2 (Refinement):** Геометрическое уточнение (refinement) каждой модели.
*   **Шаг 4.3 (Selection):** Выбор наилучшей модели (по энергетическим или структурным критериям) и очистка временных файлов.
*   **Результат:** Файл `aptamer_3D.pdb`, готовый к докингу.

### 5. Блок 5: Молекулярный докинг (Molecular Docking)
Моделирование взаимодействия "белок-аптамер".
*   **Докинг:** Используется **HDOCK** для предсказания комплекса между `protein_3D.pdb` (рецептор) и `aptamer_3D.pdb` (лиганд).
*   **Агрегация:** Сбор результатов скоринга всех кандидатов в единый CSV-файл.
*   **Валидация (QC):** Автоматическая проверка полученных PDB-файлов комплексов перед передачей в MD:
    *   Проверка наличия атомов.
    *   Минимальный порог атомов (белок > 50, РНК > 20).
    *   Генерация флага `.validated` только для корректных структур.

### 6. Блок 6: Крупнозернистая молекулярная динамика (Coarse-Grained MD)
Финальная проверка стабильности комплексов с использованием силового поля **Martini 3** и **GROMACS**. В этот блок попадают только комплексы, прошедшие валидацию в Блоке 5.

*   **Шаг 6.1 (Prep):** Подготовка полноатомных структур, разделение цепей, фиксация заголовков PDB.
*   **Шаг 6.2 (Martinize):** Конвертация структур в крупнозернистое (CG) представление:
    *   Белок: `martinize2`.
    *   РНК: `reForge` (скрипт `martinize_rna_v3.0.0.py`).
    *   Объединение топологий (`.itp`).
*   **Шаг 6.3 (Build System):** Сборка системы, определение кубической ячейки, сольватация (Martini water), добавление ионов для нейтрализации заряда.
*   **Шаг 6.4 (Minimization):** Двухступенчатая минимизация энергии (Steepest Descent).
*   **Шаг 6.5 (Equilibration):** Уравновешивание системы в ансамблях NVT и NPT.
*   **Шаг 6.6 (Production):** Запуск продуктивной симуляции на GPU.
*   **Результат:** Траектория `md.xtc` и финальная структура `md.gro` для анализа стабильности комплекса.
